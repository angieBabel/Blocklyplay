<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Blockly Demo: Generating JavaScript</title>
  <script src="../../blockly_compressed.js"></script>
  <script src="../../blocks_compressed.js"></script>
  <script src="../../javascript_compressed.js"></script>
  <script src="../../core/css.js"></script>
  <script src="../../core/blockly.js"></script>
  <script src="../../msg/js/en.js"></script>
  <script src="../interpreter/acorn_interpreter.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
  <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
    .button-success,
    .button-error,
    .button-warning,
    .button-secondary {
      color: white;
      border-radius: 20px;
      text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
      margin-left: 20px;
    }

    .button-success {
      background: rgb(28, 184, 65); /* this is a green */
    }
    canvas {
     height: 100%;
     width: 99%;
    }
    #divCanvas{
      height: 80%;
    }
  </style>

  <script type="text/javascript">
    //var image;
    var img= new Image();
    var X;
    var Y;
    var r;
    var Xaux=0,Yaux=0,limtX,limtY;
    var stepsize=20;
    var initX=0,initY=0;
    var interval, time = 1500;
    var himg=40, wimg=20;
    var roadpaint = [];
    var count=0;
    var luz=1,luzTrasera=1;

    var positionObj = {
      objX: 0,
      objY: 0,
      objZ:0,
    };

    function begin(){
      canvas = document.getElementById('canvas');
      canvas.style.border='1px solid black';
      ctx = canvas.getContext('2d');
      ////
      ancho = document.getElementById('divCanvas').offsetWidth;
      alto = document.getElementById('divCanvas').offsetHeight;
      //alert("ancho: "+ ancho + "alto" + alto);
      canvas.width= ancho;
      canvas.height = alto;
       ////

      X = canvas.width/2;
      Y = canvas.height/2;
      r = 10;
      positionObj.objX=X;
      positionObj.objY=Y;
      roadpaint.push(X+","+Y);

      Xaux = positionObj.objX;
      Yaux= positionObj.objY;
      panel();
      path();
      Avatar();
      //paint()
      //giro(90);
      //move("forward (5),upward (5),backward (5),downward (5)");
      forward(5);
      //backward(5);
      /*upward(5);*/
      //downward(5);
    }

    function stopTimer(){
      clearInterval(interval);
    }

    function panel(){
      while(initX<canvas.width-stepsize){
        initX=initX+stepsize;
        while(initY<canvas.height-stepsize){
          initY=initY+stepsize;
          ctx.beginPath();
          ctx.fillStyle = "#4C4C4C";
          ctx.arc(initX,initY,1.5,0,2*Math.PI);
          ctx.fill();
        }
        initY=0;
      }
      initX=0;
    }


    function move(allsteps){
      steps = allsteps.split(",");
      //alert(steps.length);
      c=0;
      standby= setInterval(function(){
        motion= steps[c].split(" ");
          type=motion[0];
          quantity= motion[1].substring(1,2);
          time = 300 * quantity;
        switch(type){
          case 'forward':
            forward(quantity);
            break;
          case 'backward':
            backward(quantity);
            break
          case 'upward':
            upward(quantity);
            break
          case 'downward':
            downward(quantity);
            break;
          case 'right':
            rigth(steps[c-1],quantity);
            break;
          case 'left':
            left(steps[c-1],quantity);
            break;
        }
        c++;
        //alert(time);
        if(c==steps.length){
          clearInterval(standby);
        }

      }, time);
    }
    //motion functions
    function forward(nosteps){
      //alert(positionObj.objX+","+positionObj.objY);
      //alert(roadpaint.length);
      limtX = positionObj.objX + (nosteps*stepsize);

      i=0;
      interval= setInterval(function(){
        ctx.strokeStyle = "#006400";
        ctx.fillStyle = "#6ab150";
        ctx.beginPath();
          if(Xaux<limtX){
            Xaux=Xaux+stepsize;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            paint(Xaux,positionObj.objY,nosteps);
            path();
            ctx.drawImage(img, Xaux-20, positionObj.objY-10,40,20);
            giro(0);
            /*ctx.arc(Xaux,positionObj.objY,r,0,2*Math.PI);
            ctx.fill();
            ctx.stroke();*/

            positionObj.objX=Xaux;
          }
        panel();
        i++;
        if(i==nosteps){
          stopTimer();
          upward(5);
          //giro(90);
        }
      },200);
    }

    function backward(nosteps){
      limtX= positionObj.objX - (nosteps*stepsize);
      i=0;
      interval= setInterval(function(){
        ctx.strokeStyle = "#006400";
        ctx.fillStyle = "#6ab150";
        ctx.beginPath();
          if(Xaux>limtX){
            Xaux=Xaux -stepsize;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            paint(Xaux,positionObj.objY,nosteps);
            path();
            ctx.drawImage(img, Xaux-20, positionObj.objY-10,40,20);
            giro(180);
            /*ctx.arc(Xaux,positionObj.objY,r,0,2*Math.PI);
            ctx.fill();
            ctx.stroke();*/
            positionObj.objX=Xaux;
          }
        panel();

        i++;
        if (i==nosteps) {
          stopTimer();
          downward(5);
        }
      },200);
    }

    function upward(nosteps){
      limtY=positionObj.objY-(nosteps*stepsize);
      i=0;
      interval= setInterval(function (){
        ctx.strokeStyle = "#006400";
        ctx.fillStyle = "#6ab150";
        ctx.beginPath();
          if(Yaux>limtY){
            Yaux=Yaux-stepsize;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            paint(positionObj.objX,Yaux,nosteps);
            path();
            ctx.drawImage(img, positionObj.objX-20, Yaux-10,40,20);
            giro(270);


            /*ctx.arc(positionObj.objX,Yaux,r,0,2*Math.PI);
            ctx.fill();
            ctx.stroke();*/
            positionObj.objY=Yaux;
          }
        panel();

        i++;
        if (i==nosteps) {
          stopTimer();
          backward(5);
        }
      },200);
    }

    function downward(nosteps){
      limtY=positionObj.objY+(nosteps*stepsize);
      i=0;
      interval= setInterval(function (){
        ctx.strokeStyle = "#006400";
        ctx.fillStyle = "#6ab150";
        ctx.beginPath();
          if(Yaux<limtY){
            Yaux=Yaux+stepsize;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            paint(positionObj.objX,Yaux,nosteps);
            path();
            ctx.drawImage(img, Xaux-20, positionObj.objY-10,40,20);
            luces(positionObj.objX,Yaux+20);
            giro(90);
            /*ctx.arc(positionObj.objX,Yaux,r,0,2*Math.PI);
            ctx.fill();
            ctx.stroke();*/
            positionObj.objY=Yaux;
          }
        panel();

        i++;
        if (i==nosteps) {
          stopTimer();
        }
      },200);
    }
    //Drawing avatar
    function Avatar(){

      img.src = '../../media/carro.png';
      img.id = 'imagen';
      img.onload = function() {
          ctx.drawImage(img,X-20,Y-10,himg,wimg);
          //giro();
          //giro(270);
      }
    }
    function paint(Xend,Yend, no_steps){
      //roadpaint.push(positionObj.objX + ','+ positionObj.objY);
      var srt;
      var res;
      var yinit, xinit;
      //alert(no_steps);

      //alert(roadpaint.length);
      ctx.beginPath();
      ctx.strokeStyle = "#63FFB2";
      ctx.lineWidth = wimg;
      var exe=wimg/2;

      if (roadpaint.length==1) {
        srt= roadpaint[0];
      }else{

        painroad();
        srt=roadpaint[roadpaint.length-1];

      }
      res = srt.split(",");

      //alert(count);
      ctx.moveTo(parseFloat(res[0]), res[1]);//(x,y)
      ctx.lineTo(Xend, Yend);

      if(count===0){
        roadpaint.push(Xend+","+Yend);
        //count++;
        //alert(roadpaint.length);
      }
      if(count<no_steps){
        //alert(roadpaint.length-1);
        roadpaint[roadpaint.length-1]=(Xend+','+Yend);
        //count++;

      }
      count++;
      if(count==no_steps){
        count=0;
      }


        ctx.stroke();
    }
    function painroad(){

      var yinit, xinit;
      ctx.beginPath();
      ctx.strokeStyle = "#63FFB2";
      ctx.lineWidth = wimg;
      var exe=wimg/2;

      for (var i = 0; i < roadpaint.length-1; i++) {
          //alert(roadpaint.length);
          //alert(i);
          MT=roadpaint[i];
          resMT=MT.split(",");
          ctx.moveTo(parseFloat(resMT[0]),resMT[1]);

          LT=roadpaint[i+1];
          resLT=LT.split(",");
          //alert(parseFloat(resMT[0]) + " a "+ parseFloat(resLT[0]));
          //alert(parseFloat(resMT[1]) + " a "+ parseFloat(resLT[1]));

          if (parseFloat(resMT[0]) > parseFloat(resLT[0])) {
            xinit= parseFloat(resLT[0]) - exe;
            yinit= parseFloat(resLT[1]);
          }
          if (parseFloat(resMT[0]) < parseFloat(resLT[0])){
            xinit= parseFloat(resLT[0]) + exe;
            yinit= parseFloat(resLT[1]);
          }

          if (parseFloat(resMT[1]) > parseFloat(resLT[1])) {
           xinit= parseFloat(resLT[0]) ;
            yinit= parseFloat(resLT[1])- exe;
          }
          if (parseFloat(resMT[1]) < parseFloat(resLT[1])){
            xinit= parseFloat(resLT[0]) ;
            yinit= parseFloat(resLT[1]) + exe;
          }

          //alert(xinit);
          //alert(i);
          ctx.lineTo(xinit,yinit);
          ctx.stroke();


      }
    }
    //path forward
    function path(){
      ctx.beginPath();
      ctx.lineWidth = 2;
      ctx.strokeStyle = "gray";
      ctx.rect(X, Y-100, 100, 100);
      ctx.stroke();
    }

    //function sipin
    function giro(angulo) {
      if (positionObj.objZ=!angulo) {
        positionObj.objZ= angulo;
      }
      ctx.clearRect(0,0,canvas.width,canvas.height);
      panel();
      path();
      ctx.save();
      var w=40,h=20;
      painroad();
      ctx.translate(positionObj.objX,positionObj.objY);
      ctx.rotate(angulo * (Math.PI/180));
      if (luz==1) {
        luces(20,0);
      }
      if (luzTrasera==1) {
        lucesTraceras(-20,0);
      }
      ctx.globalAlpha=1;
      ctx.drawImage(img,-w/2, -h/2,40,20);
      ctx.restore();
    }
    //Funciones de luces,
    function luces(Xx,Yy){
      var R = 13;
      // El 치ngulo de partida ap y el 치ngulo final af
      var ap = (Math.PI / 180) * -30;
      var af = (Math.PI / 180) * 30;

      //Luz izquierda
      // Las coordenadas del punto de partida en la circunferencia
      var Xap = Xx+R * Math.cos(ap);
      var Yap = Yy-5+R * Math.sin(ap);
      // estilos
      ctx.globalAlpha=0.75;
      ctx.fillStyle = "#abcdef";
      ctx.strokeStyle = "#1E90FF";
      ctx.lineWidth = 10;

      // empezamos a dibujar
      //Luz izquierda
      ctx.beginPath();
      ctx.moveTo(Xx,Yy-5);
      ctx.lineTo(Xap,Yap);
      ctx.arc(Xx,Yy-5,R,ap,af);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();

      // Luz derecha
      // Las coordenadas del punto de partida en la circunferencia
     /*nueva coordenada de punto de partida de circunferencia para faro izquierdo*/
      Yap = Yy+5+R * Math.sin(ap);
      ctx.strokeStyle = "yellow";
      ctx.beginPath();
      ctx.moveTo(Xx,Yy+5);
      ctx.lineTo(Xap,Yap);
      ctx.arc(Xx,Yy+5,R,ap,af);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
    }
    function lucesTraceras(Xx,Yy){
      var R = 5;
      // El 치ngulo de partida ap y el 치ngulo final af
      var ap = (Math.PI / 180) * 150;
      var af = (Math.PI / 180) * 210;

      //Luz izquierda
      // Las coordenadas del punto de partida en la circunferencia
      var Xap = Xx+R * Math.cos(ap);
      var Yap = Yy-5+R * Math.sin(ap);
      // estilos
      ctx.globalAlpha=0.75;
      ctx.fillStyle = "#abcdef";
      ctx.strokeStyle = "#1E90FF";
      ctx.lineWidth = 10;

      // empezamos a dibujar
      //Luz izquierda
      ctx.beginPath();
      ctx.moveTo(Xx,Yy-5);
      ctx.lineTo(Xap,Yap);
      ctx.arc(Xx,Yy-5,R,ap,af);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();

      // Luz derecha
      // Las coordenadas del punto de partida en la circunferencia
     /*nueva coordenada de punto de partida de circunferencia para faro izquierdo*/
      Yap = Yy+5+R * Math.sin(ap);
      ctx.strokeStyle = "yellow";
      ctx.beginPath();
      ctx.moveTo(Xx,Yy+5);
      ctx.lineTo(Xap,Yap);
      ctx.arc(Xx,Yy+5,R,ap,af);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
    }
  </script>


  <script type="text/javascript">
      var myInterpreter=null;
      function initApi(interpreter, scope) {
        // Add an API function for the alert() block.
        var wrapper = function(text) {
          text = text ? text.toString() : '';
          return interpreter.createPrimitive(alert(text));
        };
        interpreter.setProperty(scope, 'alert',
            interpreter.createNativeFunction(wrapper));

        // Add an API function for the prompt() block.
        wrapper = function(text) {
          text = text ? text.toString() : '';
          return interpreter.createPrimitive(prompt(text));
        };
        interpreter.setProperty(scope, 'prompt',
            interpreter.createNativeFunction(wrapper));
        // Add an API function for highlighting blocks.
        var wrapper = function(id) {
          id = id ? id.toString() : '';
          return interpreter.createPrimitive(workspace.highlightBlock(id));
        };
        interpreter.setProperty(scope, 'highlightBlock',
            interpreter.createNativeFunction(wrapper));

      }
  </script>
</head>

<body onload="begin()">
  <h1><a href="https://developers.google.com/blockly/">Blockly</a> &gt;
      <a href="../index.html">Demos</a> &gt; Generating JavaScript
  </h1>


  <div class="pure-g">
    <div class="pure-u-1-2" id="blocklyArea">
      <div id="blocklyDiv" style="position: absolute" >
        <xml id="toolbox" style="display: none">
          <category name="Logic" colour="210">
            <block type="controls_if"></block>
            <block type="logic_compare"></block>
            <block type="logic_operation"></block>
            <block type="logic_negate"></block>
            <block type="logic_boolean"></block>
          </category>


          <category name="Loops" colour="120">
            <block type="controls_repeat_ext">
              <value name="TIMES">
                <shadow type="math_number">
                  <field name="NUM">10</field>
                </shadow>
              </value>
            </block>
            <block type="controls_whileUntil"></block>
            <block type="controls_for">
              <value name="FROM">
                <shadow type="math_number">
                  <field name="NUM">1</field>
                </shadow>
              </value>
              <value name="TO">
                <shadow type="math_number">
                  <field name="NUM">10</field>
                </shadow>
              </value>
              <value name="BY">
                <shadow type="math_number">
                  <field name="NUM">1</field>
                </shadow>
              </value>
            </block>
            <block type="controls_forEach"></block>
            <block type="controls_flow_statements"></block>
          </category>


          <category name="Math" colour="230">
            <block type="math_number" gap="32"></block>
            <block type="math_arithmetic">
              <value name="A">
                <shadow type="math_number">
                  <field name="NUM">1</field>
                </shadow>
              </value>
              <value name="B">
                <shadow type="math_number">
                  <field name="NUM">1</field>
                </shadow>
              </value>
            </block>
            <block type="math_single">
              <value name="NUM">
                <shadow type="math_number">
                  <field name="NUM">9</field>
                </shadow>
              </value>
            </block>
            <block type="math_trig">
              <value name="NUM">
                <shadow type="math_number">
                  <field name="NUM">45</field>
                </shadow>
              </value>
            </block>
            <block type="math_constant"></block>
            <block type="math_number_property">
              <value name="NUMBER_TO_CHECK">
                <shadow type="math_number">
                  <field name="NUM">0</field>
                </shadow>
              </value>
            </block>
            <block type="math_change">
              <value name="DELTA">
                <shadow type="math_number">
                  <field name="NUM">1</field>
                </shadow>
              </value>
            </block>
            <block type="math_round">
              <value name="NUM">
                <shadow type="math_number">
                  <field name="NUM">3.1</field>
                </shadow>
              </value>
            </block>
            <block type="math_on_list"></block>
            <block type="math_modulo">
              <value name="DIVIDEND">
                <shadow type="math_number">
                  <field name="NUM">64</field>
                </shadow>
              </value>
              <value name="DIVISOR">
                <shadow type="math_number">
                  <field name="NUM">10</field>
                </shadow>
              </value>
            </block>
            <block type="math_constrain">
              <value name="VALUE">
                <shadow type="math_number">
                  <field name="NUM">50</field>
                </shadow>
              </value>
              <value name="LOW">
                <shadow type="math_number">
                  <field name="NUM">1</field>
                </shadow>
              </value>
              <value name="HIGH">
                <shadow type="math_number">
                  <field name="NUM">100</field>
                </shadow>
              </value>
            </block>
            <block type="math_random_int">
              <value name="FROM">
                <shadow type="math_number">
                  <field name="NUM">1</field>
                </shadow>
              </value>
              <value name="TO">
                <shadow type="math_number">
                  <field name="NUM">100</field>
                </shadow>
              </value>
            </block>
            <block type="math_random_float"></block>
          </category>


          <category name="Text" colour="160">
            <block type="text"></block>
            <block type="text_join"></block>
            <block type="text_append">
              <value name="TEXT">
                <shadow type="text"></shadow>
              </value>
            </block>
            <block type="text_length">
              <value name="VALUE">
                <shadow type="text">
                  <field name="TEXT">abc</field>
                </shadow>
              </value>
            </block>
            <block type="text_isEmpty">
              <value name="VALUE">
                <shadow type="text">
                  <field name="TEXT"></field>
                </shadow>
              </value>
            </block>
            <block type="text_indexOf">
              <value name="VALUE">
                <block type="variables_get">
                  <field name="VAR">text</field>
                </block>
              </value>
              <value name="FIND">
                <shadow type="text">
                  <field name="TEXT">abc</field>
                </shadow>
              </value>
            </block>
            <block type="text_charAt">
              <value name="VALUE">
                <block type="variables_get">
                  <field name="VAR">text</field>
                </block>
              </value>
            </block>
            <block type="text_getSubstring">
              <value name="STRING">
                <block type="variables_get">
                  <field name="VAR">text</field>
                </block>
              </value>
            </block>
            <block type="text_changeCase">
              <value name="TEXT">
                <shadow type="text">
                  <field name="TEXT">abc</field>
                </shadow>
              </value>
            </block>
            <block type="text_trim">
              <value name="TEXT">
                <shadow type="text">
                  <field name="TEXT">abc</field>
                </shadow>
              </value>
            </block>
            <block type="text_print">
              <value name="TEXT">
                <shadow type="text">
                  <field name="TEXT">abc</field>
                </shadow>
              </value>
            </block>
            <block type="text_prompt_ext">
              <value name="TEXT">
                <shadow type="text">
                  <field name="TEXT">abc</field>
                </shadow>
              </value>
            </block>
          </category>


          <category name="Lists" colour="260">
            <block type="lists_create_with">
              <mutation items="0"></mutation>
            </block>
            <block type="lists_create_with"></block>
            <block type="lists_repeat">
              <value name="NUM">
                <shadow type="math_number">
                  <field name="NUM">5</field>
                </shadow>
              </value>
            </block>
            <block type="lists_length"></block>
            <block type="lists_isEmpty"></block>
            <block type="lists_indexOf">
              <value name="VALUE">
                <block type="variables_get">
                  <field name="VAR">list</field>
                </block>
              </value>
            </block>
            <block type="lists_getIndex">
              <value name="VALUE">
                <block type="variables_get">
                  <field name="VAR">list</field>
                </block>
              </value>
            </block>
            <block type="lists_setIndex">
              <value name="LIST">
                <block type="variables_get">
                  <field name="VAR">list</field>
                </block>
              </value>
            </block>
            <block type="lists_getSublist">
              <value name="LIST">
                <block type="variables_get">
                  <field name="VAR">list</field>
                </block>
              </value>
            </block>
            <block type="lists_split">
              <value name="DELIM">
                <shadow type="text">
                  <field name="TEXT">,</field>
                </shadow>
              </value>
            </block>
          </category>


          <category name="Colour" colour="20">
            <block type="colour_picker"></block>
            <block type="colour_random"></block>
            <block type="colour_rgb">
              <value name="RED">
                <shadow type="math_number">
                  <field name="NUM">100</field>
                </shadow>
              </value>
              <value name="GREEN">
                <shadow type="math_number">
                  <field name="NUM">50</field>
                </shadow>
              </value>
              <value name="BLUE">
                <shadow type="math_number">
                  <field name="NUM">0</field>
                </shadow>
              </value>
            </block>
            <block type="colour_blend">
              <value name="COLOUR1">
                <shadow type="colour_picker">
                  <field name="COLOUR">#ff0000</field>
                </shadow>
              </value>
              <value name="COLOUR2">
                <shadow type="colour_picker">
                  <field name="COLOUR">#3333ff</field>
                </shadow>
              </value>
              <value name="RATIO">
                <shadow type="math_number">
                  <field name="NUM">0.5</field>
                </shadow>
              </value>
            </block>
          </category>


          <category name="Variables" colour="330" custom="VARIABLE"></category>


          <category name="Functions" colour="290" custom="PROCEDURE"></category>
        </xml>
        <xml id="startBlocks" style="display: none">
          <block type="variables_set" inline="true" x="20" y="20">
            <field name="VAR">n</field>
            <value name="VALUE">
              <block type="math_number">
                <field name="NUM">1</field>
              </block>
            </value>
            <next>
              <block type="controls_repeat_ext" inline="true">
                <value name="TIMES">
                  <block type="math_number">
                    <field name="NUM">4</field>
                  </block>
                </value>
                <statement name="DO">
                  <block type="variables_set" inline="true">
                    <field name="VAR">n</field>
                    <value name="VALUE">
                      <block type="math_arithmetic" inline="true">
                        <field name="OP">MULTIPLY</field>
                        <value name="A">
                          <block type="variables_get">
                            <field name="VAR">n</field>
                          </block>
                        </value>
                        <value name="B">
                          <block type="math_number">
                            <field name="NUM">2</field>
                          </block>
                        </value>
                      </block>
                    </value>
                  </block>
                </statement>
                <next>
                  <block type="text_print" inline="false">
                    <value name="TEXT">
                      <block type="variables_get">
                        <field name="VAR">n</field>
                      </block>
                    </value>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </xml>

      </div>
    </div>

    <div class="pure-u-1-2" id="divCanvas">
      <canvas id="canvas"></canvas>
    </div>

    <div class="pure-u-1-1">
        <button onclick="runCode()" class="button-success pure-button">
          Run JavaScript <i class="fa fa-play"></i>
        </button>
        <button onclick="runParallel()" class="button-success pure-button">
          Run JavaScript paralel<i class="fa fa-play"></i>
        </button>
    </div>
  </div>

  <script>
    var blocklyArea = document.getElementById('blocklyArea');
    var blocklyDiv = document.getElementById('blocklyDiv');
    var blocklyCanvas = document.getElementById('divCanvas');
    var workspace = Blockly.inject(blocklyDiv,
        { media: '../../media/',
          /*maxBlocks: 5,*/
          toolbox: document.getElementById('toolbox')});
    Blockly.Xml.domToWorkspace(workspace,
        document.getElementById('startBlocks'));
    var onresize = function(e) {
      // Compute the absolute coordinates and dimensions of blocklyArea.
      var element = blocklyArea;
      var x = 0;
      var y = 0;
      do {
        x += element.offsetLeft;
        y += element.offsetTop;
        element = element.offsetParent;
      } while (element);
      //alert(blocklyArea.offsetWidth)
      //blocklyArea.style.height='80%';
      blocklyDiv.style.height='85%';
      // Position blocklyDiv over blocklyArea.
      blocklyDiv.style.left = x + 'px';
      blocklyDiv.style.top = y + 'px';
      blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
      //blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';

      blocklyCanvas.style.height= blocklyDiv.offsetHeight+ 'px';
    };
    window.addEventListener('resize', onresize, false);
    onresize();

    function showCode() {
      // Generate JavaScript code and display it.
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      var code = Blockly.JavaScript.workspaceToCode(workspace);
      alert(code);
    }

    function runCode() {
      // Generate JavaScript code and run it.
      window.LoopTrap = 1000;
      Blockly.JavaScript.INFINITE_LOOP_TRAP =
          'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
      var code = Blockly.JavaScript.workspaceToCode(workspace);
      Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
      try {
        eval(code);
      } catch (e) {
        alert(e);
      }
    }

    function runParallel(){
      Blockly.JavaScript.STATEMENT_PREFIX = 'highlightBlock(%1);\n';
      Blockly.JavaScript.addReservedWords('highlightBlock');
      var allXml = Blockly.Xml.workspaceToDom(workspace);
       console.log(allXml);
       xml=allXml.childNodes;
       console.log('<xml>'+xml[0].outerHTML+'</xml>');

       var allCode = [];
      for (var i = 0; i<xml.length; i++) {
        alert('entro al ciclo');
        var headless = new Blockly.Workspace();
        Blockly.Xml.domToWorkspace(headless, '<xml>'+xml[i].outerHTML+'</xml>');
        allCode.push(Blockly.JavaScript.workspaceToCode(headless));
        headless.dispose();


        myInterpreter = new Interpreter(allCode[i], initApi);
      }

      alert(allCode.length);
      nextStep();
    }

    function nextStep() {
      if (myInterpreter.step()) {
        window.setTimeout(nextStep, 10);
      }
    }


    function onchange() {
      document.getElementById('capacity').innerHTML = workspace.remainingCapacity();
    }


  </script>

</body>
</html>
