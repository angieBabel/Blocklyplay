<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Elevator Project</title>
<!-- Responsive css
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">-->
<link rel="stylesheet" href="styles.css">

 <!-- Angular Material style sheet -->
  <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<!-- Angular Material requires Angular.js Libraries-->
  <script type="text/javascript"  src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.min.js"></script>
  <script type="text/javascript"  src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-animate.min.js"></script>
  <script type="text/javascript"  src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-aria.min.js"></script>
  <script type="text/javascript"  src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-messages.min.js"></script>

  <!-- Angular Material Library -->
  <script type="text/javascript"  src="http://ajax.googleapis.com/ajax/libs/angular_material/1.1.0-rc2/angular-material.min.js"></script>

<!-- interprete de JS -->
<script src="../acorn_interpreter.js"></script>
<script src="../acorn.js"></script>
<script src="../interpreter.js"></script>
<!-- <script src="..//storage.js"></script> -->
<script src="../blockly_compressed.js"></script>
<script src="../blocks_compressed.js"></script>
<script src="../javascript_compressed.js"></script>
<script src="../core/css.js"></script>
<script src="../core/blockly.js"></script>
<script src="../msg/js/en.js"></script>
<script src="../blocks/custom.js"></script>
<script src="../generators/javascript/custom.js"></script>

<script type="text/javascript" src="../moves.js"></script>
<script type="text/javascript" src="../filesaver.js"></script>
<script type="text/javascript" src="../Blob.js"></script>
<!-- Funciones comunes para controlar el juego -->
<script type="text/javascript" src="../controlFunctions.js"></script>
<!-- agregar bloques de hardware -->
<script src="../blocks/hardware.js"></script>
<script src="../generators/javascript/hardware.js"></script>
  <!-- para agregar las librerias del socket -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.socket.io/socket.io-1.2.1.js"></script>

<script type="text/javascript">
  /*var image;*/
  //las variables generales se pasaron a moves.js
  //inicialización de las variables propias del ejercicio 3
    //Posisiones recolectadas por el click
    var clickX,clickY
    var canvas;
    //Variables para saber que piso presiono
    var piso=0;
    //la variable de positionObj se paso a moves.js
    //el objeto de solutionObj se paso a moves.js
  function begin(){
    canvas = document.getElementById('canvas');
    canvas.style.border='1px solid black';
    canvas.style.margin='0px 0px 0px 10px';
    ctx = canvas.getContext('2d');
    ancho = document.getElementById('divCanvas').offsetWidth;
    alto = document.getElementById('divCanvas').offsetHeight;
    canvas.addEventListener("mousedown", getPosition, false);
    canvas.width= ancho;
    canvas.height = alto;
    stepsizeX=canvas.width/9  ;
    stepsizeY=canvas.height/5;

    X = stepsizeX*4;
    Y = stepsizeY*4;
    positionObj.objX=X;
    positionObj.objY=Y;
    Xaux = positionObj.objX;
    Yaux= positionObj.objY;
    panel();
  }

  //la funcion de stopTimer se paso al archivo de controlFunctions.js

  function panel(){
    var imgback = new Image();
            imgback.src = "../media/edificio1.png";

     imgback.onload = function() {
      ctx.drawImage(imgback, 0,0,canvas.width,canvas.height);

        while(initX<canvas.width-stepsizeX){
          initX=initX+stepsizeX;
            while(initY<canvas.height-stepsizeY){
              initY=initY+stepsizeY;
              ctx.beginPath();
              ctx.fillStyle = "yellow";
              ctx.arc(initX,initY,1.5,0,2*Math.PI);
              ctx.fill();
            }
            initY=0;
        }
        initX=0;


        /*var building = new Image();
          building.src = "../media/edificio1.png";

        building.onload= function(){
          ctx.drawImage(building, stepsizeX*1.5,stepsizeY*3,stepsizeX*6,stepsizeY*5);
        }*/

        var piso1 = new Image();
            piso1.src = "../media/piso1.png";
        piso1.onload = function() {
          ctx.drawImage(piso1, (stepsizeX*7),(stepsizeY*4),stepsizeY,stepsizeY);
        }
        var piso2 = new Image();
            piso2.src = "../media/piso2.png";
        piso2.onload = function() {
          ctx.drawImage(piso2, (stepsizeX*7),(stepsizeY*3),stepsizeY,stepsizeY);
        }
        var piso3 = new Image();
            piso3.src = "../media/piso3.png";
        piso3.onload = function() {
          ctx.drawImage(piso3, (stepsizeX*7),(stepsizeY*2),stepsizeY,stepsizeY);
        }
        var piso4 = new Image();
            piso4.src = "../media/piso4.png";
        piso4.onload = function() {
          ctx.drawImage(piso4, (stepsizeX*7),(stepsizeY*1),stepsizeY,stepsizeY);
        }
        Avatar();
      }

  }
  //Drawing avatar

  function Avatar(){
    var img = new Image();//se debe de crear siempre el objeto para que siempre lo carge, sino se queda en el cache y no corre bien en safari

    var positionX, positionY;

    img.id = 'imagen';
    img.onload = function() {
      ctx.drawImage(img,positionObj.objX,positionObj.objY+stepsizeY*.2,stepsizeX*.8,stepsizeY*.6);
    }
    img.src = '../media/persona.png';//el img.src se pone despues del onload para asegurar su carga
  }

  //Funcion que agrega el EventListener para el canvas
  function listener() {
    //se agrega el eventlistener
    canvas.addEventListener("mousedown", getPosition, false);
    //se pone la variable acabo en 0 para que espere hasta que un boton sea presionado
    acabo=0;
  }
  //funcion que obtiene las coordenadas del click del usuario
  function getPosition(event){
    //si es para chorme
    if(event.offsetX){
     clickX= event.clientX;
     clickY= event.clientY;
     clickX -= canvas.offsetLeft;
     clickY -= canvas.offsetTop;
    }
    //si es para firefox
    if(event.clientX){
     clickX= event.clientX;
     clickY= event.clientY;
     clickX -= canvas.offsetLeft;
     clickY -= canvas.offsetTop;
    }
    //se divide la coordenada entre el número de pasos para obtener la ubicación en el grid generado
    clickX=clickX/stepsizeX;
    clickY=clickY/stepsizeY;
    /*piso=0;*/
    //Validar los click para saber donde presiono
    if (clickX>7 && clickX<8 && clickY>=4 && clickY<5){//Validar boton piso 1
      piso=1;
      acabo=1;
    } else if (clickX>7 && clickX<8 && clickY>=3 && clickY<4){//Validar boton piso 2
      piso=2;
      acabo=1;
    } else if (clickX>7 && clickX<8 && clickY>=2 && clickY<3){ //Validar boton piso 3
      piso=3;
      alert(piso);
      acabo=1;
    }else if (clickX>7 && clickX<8 && clickY>=1 && clickY<2){ //Validar boton piso 3
      piso=4;
      acabo=1;
    }else {
      alert('debes presionar un boton')
    }
  }

  function getFloor() {
    return piso;
  }

  function checkFloor(){
    //Validar los click para saber donde presiono
    if (clickX>7 && clickX<8 && clickY>=4 && clickY<5){//Validar boton piso 1
      alert(Math.round10(positionObj.objY,-2)+','+stepsizeY*3);
      if (Math.round10(positionObj.objY,-2)==stepsizeY*3) {
        alert('Felicidades haz completado correctamente el puzzle');
      }
      else{
        alert('Esta vez no lo conseguiste, intenta de nuevo');
      }
    } else if (clickX>7 && clickX<8 && clickY>=3 && clickY<4){//Validar boton piso 2
      alert(Math.round10(positionObj.objY,-2)+','+stepsizeY*2);
        if (Math.round10(positionObj.objY,-2)==stepsizeY*2) {
          alert('Felicidades haz completado correctamente el puzzle');
        }
        else{
          alert('Esta vez no lo conseguiste, intenta de nuevo');
        }
    } else if (clickX>7 && clickX<8 && clickY>=2 && clickY<3){ //Validar boton piso 3
       alert(Math.round10(positionObj.objY,-2)+','+stepsizeY);
        if (Math.round10(positionObj.objY,-2)==stepsizeY) {
          alert('Felicidades haz completado correctamente el puzzle');
        }
        else{
          alert('Esta vez no lo conseguiste, intenta de nuevo');
        }
    } else /*if (clickX>7 && clickX<8 && clickY>=1 && clickY<2)*/{ //Validar boton piso 4
      alert(Math.round10(positionObj.objY,-2));
        if (Math.round10(positionObj.objY,-2)==0){
          alert('Felicidades haz completado correctamente el puzzle');
        }
        else{
          alert('Esta vez no lo conseguiste, intenta de nuevo');
        }
    }
    location.reload();
  }
  //funcion para ocultar el toolbox
  function ocultar(){
     $('.blocklyToolboxDiv').toggle('slow');
  }
</script>
<!-- El script para el interprete esta en controlFunctions.js -->
</head>
<body onload="begin()" ng-app="Blocklyplay" ng-style="{'background-color':'#EEEEEE'}">
  <div layout="row" layout-wrap id="menu">
    <div flex="10" layout-align="center center" layout="row">
      <md-button class="md-fab md-mini" aria-label="Settings" onclick="ocultar()">
        <md-icon><i class="material-icons">dehaze</i></md-icon>
      </md-button>
    </div>
    <div flex="30">
      <h3>Conditionals and events</h3>
    </div>
    <div flex='40'>
      <md-button class="md-fab md-mini" aria-label="Panel" ng-style="{'background-color':'#00E676'}" onclick="location.href = '../index.html'">
        <md-icon><i class="material-icons">home</i></md-icon>
      </md-button>
      <md-button class="md-fab md-mini" aria-label="Panel" ng-style="{'background-color':'#80DEEA'}"onclick="location.href = '../projecthouse/housel1.html'" >
        1
      </md-button>
      <md-button class="md-fab md-mini" aria-label="Panel" ng-style="{'background-color':'#4FC3F7'}"onclick="location.href = '../projectstreetlight/streetlightl1.html'" >
        2
      </md-button>
      <md-button class="md-fab md-mini" aria-label="Panel" ng-style="{'background-color':'#42A5F5'}"onclick="location.href = 'elevatorl1.html'">
        3
      </md-button>
      <md-button class="md-fab md-mini" aria-label="Panel" ng-style="{'background-color':'#3F51B5'}"onclick="location.href = '../projectbridge/bridgel1.html'">
        4
      </md-button>
      <md-button class="md-fab md-mini" aria-label="Panel" ng-style="{'background-color':'#5E35B1'}"onclick="location.href = '../projectturbine/turbinel1.html'">
        5
      </md-button>
      <md-button class="md-fab md-mini" aria-label="Panel" ng-style="{'background-color':'#B9191D'}"onclick="location.href = '../projectturbine/turbinel2.html'">
        <!-- <md-icon ></md-icon> -->6
      </md-button>
    </div>
    <div flex='20' class="dialog-demo-content" ng-controller="AppCtrl">
        <md-button class="md-warn md-raised md-hue-2" ng-style="{'background-color':'#F0D345','color':'white'}" ng-click="showTabDialog($event)" flex="100"  flex-gt-md="auto">
          Instructions <i class="material-icons">help_outline</i>
        </md-button>
    </div> 

  </div>
  <div layout="row" id="blocklyArea">
    <div flex='40'>
        <div id="blocklyDiv" style="position: absolute" ></div>
    </div>

    <div flex='60' id="divCanvas">

        <canvas id="canvas"></canvas>

    </div>
  </div>
  <div layout="row">
    <div layout="row" flex="50">
      <div flex="30">
        <md-button  onclick="runCode()" class="md-raised md-cornered btnfunction" ng-style="{'background-color':'#00E676','border-radius':'10px','border-color': '10px solid white', 'color':'white'}">Run code<i class="material-icons">play_circle_outline</i></md-button>
      </div>
      <div flex="30">
        <md-button onclick="showCode()" class="md-raised md-cornered btnfunction" ng-style="{'background-color':'#1DE9B6','border-radius':'10px', 'color':'white','border-color': '10px solid white'}">Show Code<i class="material-icons">code</i></md-button>
      </div>
      <div flex="30">
        <md-button  onclick="" class="md-raised md-cornered btnfunction" ng-style="{'background-color':'#00E5FF','border-radius':'10px','border-color': '10px solid white', 'color':'white'}">Save<i class="material-icons">save</i></md-button>
      </div>
    </div>
    <div layout="row" flex="50" layout-align="center center">
      <md-button class="md-icon-button md-accent" aria-label="Favorite">
        <md-icon md-svg-icon="img/icons/favorite.svg"></md-icon>
      </md-button>
      <div flex="40">
        <md-button  onclick="saveXML()" class="md-raised md-cornered btnfunction" ng-style="{'background-color':'#FF9100','border-radius':'10px','border-color': '10px solid white', 'color':'white'}">Download project <i class="material-icons">file_download</i></md-button>
      </div>
      <div flex="50">
        <md-button onclick="showFileInput()" id='loadbutton' class="md-raised md-cornered btnfunction" ng-style="{'background-color':'#FFC400','border-radius':'10px','border-color': '10px solid white', 'color':'white'}">Load project<i class="material-icons">file_upload</i>
        </md-button>
        <br>
       <input type='file' style="display:none" id='your-files'></input>
      </div>
    </div>
  </div>
<xml id="toolbox" style="display: none">
    <category name="Control" colour="355">
      <block type="wait"></block>
      <block type="stop"></block>
      <block type="controls_repeat_ext">
        <value name="TIMES">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
      </block>
      <block type="controls_whileUntil"></block>
      <block type="controls_for">
        <value name="FROM">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="TO">
          <shadow type="math_number">
            <field name="NUM">10</field>
          </shadow>
        </value>
        <value name="BY">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="controls_flow_statements"></block>
    </category>

    <category name="Move" colour="79">
      <block type="mover"></block>
      <block type="mover_pintando"></block>
      <block type="girar"></block>
    </category>

    <category name="Lights" colour="176">
      <block type="blinker"></block>
      <block type="lights"></block>
    </category>

    <category name="Sounds" colour="290">
      <block type="sonido"></block>
    </category>

    <category name="Math" colour="190">
      <block type="math_number" gap="32"></block>
      <block type="math_arithmetic">
        <value name="A">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="B">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
    </category>

    <category name="Text" colour="210">
      <block type="text"></block>
      <block type="text_isEmpty">
        <value name="VALUE">
          <shadow type="text">
            <field name="TEXT"></field>
          </shadow>
        </value>
      </block>
      <block type="text_print">
        <value name="TEXT">
          <shadow type="text">
            <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
      <block type="text_prompt_ext">
        <value name="TEXT">
          <shadow type="text">
             <field name="TEXT">abc</field>
          </shadow>
        </value>
      </block>
    </category>

    <category name="Logic" colour="25">
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
    </category>

    <category name="Colour" colour="160">
      <block type="colour_picker"></block>
      <block type="colour_random"></block>
      <block type="colour_rgb">
        <value name="RED">
          <shadow type="math_number">
            <field name="NUM">100</field>
          </shadow>
        </value>
        <value name="GREEN">
          <shadow type="math_number">
            <field name="NUM">50</field>
          </shadow>
        </value>
        <value name="BLUE">
          <shadow type="math_number">
            <field name="NUM">0</field>
          </shadow>
        </value>
      </block>
      <block type="colour_blend">
        <value name="COLOUR1">
          <shadow type="colour_picker">
            <field name="COLOUR">#ff0000</field>
          </shadow>
        </value>
        <value name="COLOUR2">
          <shadow type="colour_picker">
            <field name="COLOUR">#3333ff</field>
          </shadow>
        </value>
        <value name="RATIO">
          <shadow type="math_number">
            <field name="NUM">0.5</field>
          </shadow>
        </value>
      </block>
    </category>
    <sep></sep>
    <category name="Hardware" colour="354">
      <block type="ledDisplayed">
        <value name="PIN">
          <shadow type="pind">
            <field name="PIN">1</field>
          </shadow>
        </value>
        <value name="Turn">
          <shadow type="status">
            <field name="on/off">On</field>
          </shadow>
        </value>
      </block>
      <block type="motorDisplayed">
        <value name="steps">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
        <value name="direction">
          <shadow type="direction">
            <field name="direction">Forward</field>
          </shadow>
        </value>
        <value name="speed">
          <shadow type="speed">
            <field name="speed">1</field>
          </shadow>
        </value>
      </block>

      <block type="buzzerDisplayed">
        <value name="PIN">
          <shadow type="pind">
            <field name="PIN">1</field>
          </shadow>
        </value>
        <value name="Tone">
          <shadow type="tone">
            <field name="tone">Do</field>
          </shadow>
        </value>
        <value name="Secs">
          <shadow type="math_number">
            <field name="NUM">1</field>
          </shadow>
        </value>
      </block>
      <block type="pantallaDisplayed">
        <value name="message">
          <shadow type="text">
            <field name="TEXT">Type message here</field>
          </shadow>
        </value>
        <value name="color">
          <shadow type="colour_picker">
            <field name="COLOUR">#ff0000</field>
          </shadow>
        </value>

      </block>
      <block type="botonDisplayed">
        <value name="PIN">
          <shadow type="pind">
            <field name="PIN">1</field>
          </shadow>
        </value>
        <value name="Status">
          <shadow type="status">
            <field name="on/off">On</field>
          </shadow>
        </value>


      </block>

      <block type="status"></block>
      <block type="speed"></block>
      <block type="pina"></block>
      <block type="pind"></block>
      <block type="tone"></block>
    </category>

    <sep></sep>
    <category name="Variables" colour="330" custom="VARIABLE"></category>
    <category name="Functions" colour="46" custom="PROCEDURE"></category>

</xml>
<script type="text/javascript">
var myWidth = 0, myHeight = 0;
    function alertSize() {

      if( typeof( window.innerWidth ) == 'number' ) {
        //No-IE
        myWidth = window.innerWidth;
        myHeight = window.innerHeight;
      } else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) {
        //IE 6+
        myWidth = document.documentElement.clientWidth;
        myHeight = document.documentElement.clientHeight;
      } else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
        //IE 4 compatible
        myWidth = document.body.clientWidth;
        myHeight = document.body.clientHeight;
      }
      /*window.alert( 'Width = ' + myWidth );
      window.alert( 'Height = ' + myHeight ); */

    }
    alertSize();

'use strict';
    var blocklyArea = document.getElementById('blocklyArea');
    var blocklyDiv = document.getElementById('blocklyDiv');
    var blocklyCanvas = document.getElementById('divCanvas');
    var workspace = Blockly.inject(blocklyDiv,
        { media: '../media/',
          zoom:
           {controls: true,
            wheel: true,
            startScale: 1.0,
            maxScale: 3,
            minScale: 0.3,
            scaleSpeed: 1.2},
          toolbox: document.getElementById('toolbox')});

  var onresize = function(e) {
    // Compute the absolute coordinates and dimensions of blocklyArea.
    var element = blocklyArea;
    var x = 0;
    var y = 0;
    do {
      x += element.offsetLeft;
      y += element.offsetTop;
      element = element.offsetParent;
    } while (element);
    //alert(blocklyArea.offsetWidth)
    // Position blocklyDiv over blocklyArea.
    blocklyDiv.style.left = x + 'px';
    //blocklyDiv.style.top = y + 'px';

    blocklyDiv.style.width = (myWidth*.4) + 'px';
    blocklyDiv.style.height = (myHeight*.85)+ 'px';
    blocklyCanvas.style.height= (myHeight*.85)+ 'px';
    };

  window.addEventListener('resize', onresize, false);
  onresize();


  var program = window.localStorage.getItem("panel3");
  Blockly.mainWorkspace.clear();
  var textToDom = Blockly.Xml.textToDom(program);
  Blockly.Xml.domToWorkspace(Blockly.mainWorkspace, textToDom);

  //La funcion para mostrar el codigo esta en el archivo controlFunctiones.js


  function nextStep() {
    if (highlightPause) {
      // A block has been highlighted.  Pause execution here.
      highlightPause = false;
    } else {
      // Keep executing until a highlight statement is reached.
      /*stepCode();*/
    }
    if (!myInterpreter.step()) {
      /*window.setTimeout(finish, 15);*/
      clearInterval(intervalo);
      checkFloor();
    }
  }
  function finish(){
    if(acabo==1){
          nextStep();
        }
  }

  function runCode() {
    //funcion para convertir el codigo al interprete, esta en el archivo controlFunctions.js
    parseCode();
    //se crea un intervalo que estara leyendo el siguiente paso cada que haya terminado la instruccion en curso
    intervalo= setInterval(function(){finish();},15)
    //se guarda lo que hay en el workspaces en el almcaneamiento local
    var xml = Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);
    var domToPretty = Blockly.Xml.domToPrettyText(xml);
    window.localStorage.setItem("panel3", domToPretty);
  }
  function screenshotPage() {
    //para sacar el thumnail
          var previa = window.localStorage.getItem("preview");
          var thumb = document.getElementById('thumbnail');
          console.log(thumb);
          var prev = previa;
          thumb.innerHTML=previa;
          thumb.style.cssText="zoom: 0.5;/* For Firefox */-moz-transform: scale(0.5);-moz-transform-origin: 0 0;"
          console.log(pre);
          //se crea el nuevo body
          var screenshot = document.createElement('body');
          //se clona el header al nuevo
          var copy = document.documentElement.cloneNode(true);
          var newHead = copy.querySelector('head').cloneNode(true);
          //se crea el base
          var b = document.createElement('base');
          b.href = document.location.protocol + '//' + location.host;
          //se agrega el base al new head
          newHead.insertBefore(b, newHead.firstChild);
          //se agrega el newhead al body
          screenshot.insertBefore(newHead, screenshot.firstChild);
          //se clona el div del SVG
          var newSVG = document.getElementById('blocklyDiv').cloneNode(true);
          var trash = newSVG.querySelector('g.blocklyTrash');
          trash.remove();
          var scrolV = newSVG.querySelector('g.blocklyScrollbarVertical');
          scrolV.remove();
          var scrolH = newSVG.querySelector('g.blocklyScrollbarHorizontal');
          scrolH.remove();
          var zoom = newSVG.querySelector('g.blocklyZoom');
          zoom.remove();
          console.log(newSVG);
          //se inserta el SVG al body
          screenshot.appendChild(newSVG);
          screenshot.style.pointerEvents = 'none';
          screenshot.style.overflow = 'hidden';
          screenshot.style.webkitUserSelect = 'none';
          screenshot.style.mozUserSelect = 'none';
          screenshot.style.msUserSelect = 'none';
          screenshot.style.oUserSelect = 'none';
          screenshot.style.userSelect = 'none';
          screenshot.dataset.scrollX = window.scrollX;
          screenshot.dataset.scrollY = window.scrollY;

          while (thumb.firstChild) {
              thumb.removeChild(thumb.firstChild);
          }
          thumb.appendChild(newSVG);
          console.log(thumb);

          window.localStorage.setItem("preview", newSVG.outerHTML);   
  }
  function generate() {
      screenshotPage();
  }
  //las funciones de guardar XML estan en el archivo controlFunctions.js

  //Variable para controlar la subida de archivos
  var control = document.getElementById("your-files");//se hace referencia al input de tipo file
    //se agrega un EventListener, para saber que se ha acceido a el
    control.addEventListener("change", function(event) {
         var buttonload=document.getElementById('loadbutton').style.cssText="display:true;background:#FFC400;border-radius:10px; color:white;border-color: 10px solid white;"
         //buttonload.style.cssText="background-color:'#0091EA';border-radius:10px; color:white;"
         loadXML();
         var loadinput=document.getElementById('your-files').style='display:none';
    }, false);
  //funcion que habilita el file input
  function showFileInput(){
    var loadinput=document.getElementById('your-files').style='display:true';
    var buttonload=document.getElementById('loadbutton').style='display:none';
  }

    
  //funcion que carga un archivo XML
  function loadXML() {
    //se define la funcion Reader, de tipo FileReader
    var reader = new FileReader();
    reader.onload = function(event) {
        var contents = event.target.result;//se almacena el resultado en una variable llamada content
        console.log("File contents: " + contents);
        Blockly.mainWorkspace.clear();//se limpia el workspace para cargar el nuevo XML
        var textToDom = Blockly.Xml.textToDom(contents);//se carga el resultado de la lectura del archivo y se pasa como parametro a la funcion textToDom para que se almacene en el DOM
        Blockly.Xml.domToWorkspace(Blockly.mainWorkspace, textToDom);//se convierte el Dom a workspace
    };
    //en caso de haber error, lo lanza
    reader.onerror = function(event) {
        console.error("File could not be read! Code " + event.target.error.code);
    };
    //esta función manda llamar al reader como texto, y se pasa como parametro el archivo que almacenamos en la cariable control, como es un arreglo, se pasa el primer (unico) elemento
    reader.readAsText(control.files[0]);
  }
function pasoHW(){
  var socket = io.connect('http://edison.local:3000');
  var code = Blockly.JavaScript.workspaceToCode(workspace);
  code = code.replace(/[']/gi, "");
  socket.emit('changefunction',code);
  //alert(code);
} 
</script>
<script type="text/javascript">
  'use strict';
    /**
     * You must include the dependency on 'ngMaterial'
     */
    angular.module('Blocklyplay', ['ngMaterial']);
    
    angular.module('Blocklyplay', ['ngMaterial'])
  .controller('AppCtrl', function($scope, $mdDialog, $mdMedia) {
    $scope.status = '  ';
    $scope.customFullscreen = $mdMedia('xs') || $mdMedia('sm');
    $scope.showTabDialog = function(ev) {
      $mdDialog.show({
        controller: DialogController,
        templateUrl: '../instructions/elevator.html',
        parent: angular.element(document.body),
        targetEvent: ev,
        clickOutsideToClose:true
      }).then(function(answer) {
            $scope.status = 'You said the information was "' + answer + '".';
          }, function() {
            $scope.status = 'You cancelled the dialog.';
          });
    };
  });
  function DialogController($scope, $mdDialog) {
    $scope.hide = function() {
      $mdDialog.hide();
    };
    $scope.cancel = function() {
      $mdDialog.cancel();
    };
    $scope.answer = function(answer) {
      $mdDialog.hide(answer);
    };
  }
</script>
</body>
</html>
